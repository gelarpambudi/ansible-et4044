- name: Install python3
  apt:
    name: python3
    state: present

- name: install pip3
  apt:
    name: pip3
    state: present
    
- name: clone repo
  ansible.builtin.git:
    src: {{'url_repo'}}
    dest: C:\Tubes sdn

-name: install flask
  pip:
    name: flask
    
- name: Replace default service configuration
  ansible.builtin.template:
    src: ansible-tubes/roles/deploy_app/templates/app.service.j2
    dest: /lib/systemd/system
    force: yes
    group: "{{ os_group }}"
    owner: "{{ os_user }}"
    mode : 0644
    backup: yes
  register: service_config
    
- name: Restart service configuration
  systemd:
    name: "{{ systemd_name }}"
    enabled: yes
    daemon_reload: yes
    state: restarted
  when: service_config.changed

- name: Check if service running
  systemd:
    name: "{{ systemd_name }}"
    enabled: yes
    daemon_reload: yes
    state: started
    masked: no
